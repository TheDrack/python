name: "üß¨ JARVIS: Orquestrador de Evolu√ß√£o"

on:
  push:
    branches: [ main ]

jobs:
  evolution:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: astral-sh/setup-uv@v5

      - name: üß¨ Evoluir DNA
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          export PYTHONPATH=$PYTHONPATH:$(pwd)
          
          # 1. Deixa o Mutador gerir a miss√£o do Roadmap (ele j√° usa o Analyzer e o Service)
          uv run python scripts/metabolism_mutator.py --strategy "minimal_change" --intent "auto-evolution-mission"
          
          # 2. Se o Mutador criou uma branch (nova miss√£o), abre a PR
          BRANCH=$(git rev-parse --abbrev-ref HEAD)
          if [ "$BRANCH" != "main" ]; then
            gh pr create --title "üß¨ Evolu√ß√£o: Pr√≥xima Miss√£o do Roadmap" \
                         --body "Interface de evolu√ß√£o autom√°tica disparada pelo merge na main." \
                         --base main --head $BRANCH
          fi
